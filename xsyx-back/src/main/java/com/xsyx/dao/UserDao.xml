<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xsyx.dao.UserDao">
    <!-- resultMap映射 -->
    <resultMap id="UserMap" type="User">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="head_portrait" property="headPortrait"/>
        <result column="phone" property="phone"/>
        <result column="signature" property="signature"/>
        <result column="birthday" property="birthday"/>
        <result column="uname" property="uname"/>
        <result column="sex" property="sex"/>
        <result column="id_card" property="idCard"/>
        <result column="last_login_time" property="lastLoginTime"/>
        <result column="is_delete" property="isDelete"/>
        <association property="merid" column="{fk=merid}"
           select="com.xsyx.dao.MerchantsDao.a_Merchants_By_merid" javaType="Merchants" fetchType="lazy"/>
    </resultMap>

    <!-- 查询所有方法 -->
    <select id="queryAll" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user;
    </select>

    <!-- 根据主键id查询数据方法 -->
    <select id="queryById" parameterType="int" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user where id = #{id};
    </select>

    <!-- 根据User条件查询数据方法 -->
    <select id="query" resultMap="UserMap">
        select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait 
        from user 
        <where>
            <if test="id != null"> and id = #{id}</if>
            <if test="username != null"> and username = #{username}</if>
            <if test="password != null"> and password = #{password}</if>
            <if test="headPortrait != null"> and head_portrait = #{headPortrait}</if>
            <if test="phone != null"> and phone = #{phone}</if>
            <if test="signature != null"> and signature = #{signature}</if>
            <if test="birthday != null"> and birthday = #{birthday}</if>
            <if test="uname != null"> and uname = #{uname}</if>
            <if test="sex != null"> and sex = #{sex}</if>
            <if test="idCard != null"> and id_card = #{idCard}</if>
            <if test="merid != null">
                 <if test="merid.id != null"> and merid = #{merid.id}</if>
            </if>
            <if test="lastLoginTime != null"> and last_login_time = #{lastLoginTime}</if>
            <if test="isDelete != null"> and is_delete = #{isDelete}</if> 
        </where>
    </select>

    <!-- 根据User插入数据方法 -->
    <insert id="insert" parameterType="User" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        insert into user (id,username,password,head_portrait,phone,signature,birthday,uname,sex,id_card,merid,last_login_time,is_delete) values 
        (
            #{id},
            #{username},
            #{password},
            #{headPortrait},
            #{phone},
            #{signature},
            #{birthday},
            #{uname},
            #{sex},
            #{idCard},
            #{merid.id},
            <if test="lastLoginTime != null">#{lastLoginTime}</if><if test="lastLoginTime == null">default</if>,
            <if test="isDelete != null">#{isDelete}</if><if test="isDelete == null">default</if>
        ); 
    </insert>

    <!-- 根据User插入多条数据方法 -->
    <insert id="inserts" parameterType="List" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        insert into user (id,username,password,head_portrait,phone,signature,birthday,uname,sex,id_card,merid,last_login_time,is_delete) values 
        <foreach collection="users" item="item" separator=",">
            (
                #{item.id},
                #{item.username},
                #{item.password},
                #{item.headPortrait},
                #{item.phone},
                #{item.signature},
                #{item.birthday},
                #{item.uname},
                #{item.sex},
                #{item.idCard},
                #{item.merid.id},
                <if test="item.lastLoginTime != null">#{item.lastLoginTime}</if><if test="item.lastLoginTime == null">default</if>,
                <if test="item.isDelete != null">#{item.isDelete}</if><if test="item.isDelete == null">default</if>
            ) 
        </foreach>
    </insert>

    <!-- 根据User条件修改单条数据方法,从传入对象获取主键id -->
    <update id="updateById" parameterType="User">
        update user 
        <set>
            <if test="username != null">username = #{username},</if>
            <if test="password != null">password = #{password},</if>
            <if test="headPortrait != null">head_portrait = #{headPortrait},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="signature != null">signature = #{signature},</if>
            <if test="birthday != null">birthday = #{birthday},</if>
            <if test="uname != null">uname = #{uname},</if>
            <if test="sex != null">sex = #{sex},</if>
            <if test="idCard != null">id_card = #{idCard},</if>
            <if test="merid != null">
                <if test="merid.id != null">merid = #{merid.id},</if>
            </if>
            <if test="lastLoginTime != null">last_login_time = #{lastLoginTime},</if>
            <if test="isDelete != null">is_delete = #{isDelete},</if>
        </set>
        where id = #{id}
    </update>

    <!-- 关联查询,调用者:"com.xsyx.dao.ShopcarDao" -->
    <select id="a_User_By_uid" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user where id = #{fk};
    </select>


    <!-- 关联查询,调用者:"com.xsyx.dao.MerchantsApplyDao" -->
    <select id="a_User_By_user_id" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user where id = #{fk};
    </select>


    <!-- 关联查询,调用者:"com.xsyx.dao.SearchRecordDao" -->
    <select id="a_User_By_user" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user where id = #{fk};
    </select>


    <!-- 关联查询,调用者:"com.xsyx.dao.MerLogDao" -->
    <select id="a_User_By_emp" resultMap="UserMap">
       select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user where id = #{fk};
    </select>

    <!-- 用户登录 -->
    <select id="login" resultMap="UserMap">
        select birthday,uname,last_login_time,signature,sex,id_card,is_delete,password,phone,merid,id,username,head_portrait from user
        where (username=#{nameOrPhone} or phone=#{nameOrPhone}) and password=#{password} limit 1;
    </select>

</mapper>