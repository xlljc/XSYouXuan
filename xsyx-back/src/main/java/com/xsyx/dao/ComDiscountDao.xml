<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xsyx.dao.ComDiscountDao">




    <!-- resultMap映射 -->
    <resultMap id="ComDiscountMap" type="ComDiscount">
        <id column="id" property="id"/>
        <result column="commodity" property="commodity"/>
        <result column="start_time" property="startTime"/>
        <result column="end_time" property="endTime"/>
        <result column="discount" property="discount"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <!-- 查询所有方法 -->
    <select id="queryAll" resultMap="ComDiscountMap">
       select commodity,start_time,end_time,discount,remark,id from com_discount;
    </select>

    <!-- 根据主键id查询数据方法 -->
    <select id="queryById" parameterType="int" resultMap="ComDiscountMap">
       select commodity,start_time,end_time,discount,remark,id from com_discount where id = #{id};
    </select>

    <!-- 根据ComDiscount条件查询数据方法 -->
    <select id="query" resultMap="ComDiscountMap">
        select commodity,start_time,end_time,discount,remark,id 
        from com_discount 
        <where>
            <if test="id != null"> and id = #{id}</if>
            <if test="commodity != null"> and commodity = #{commodity}</if>
            <if test="startTime != null"> and start_time = #{startTime}</if>
            <if test="endTime != null"> and end_time = #{endTime}</if>
            <if test="discount != null"> and discount = #{discount}</if>
            <if test="remark != null"> and remark = #{remark}</if> 
        </where>
    </select>

    <!-- 根据ComDiscount插入数据方法 -->
    <insert id="insert" parameterType="ComDiscount" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        insert into com_discount (id,commodity,start_time,end_time,discount,remark) values 
        (
            #{id},
            #{commodity},
            #{startTime},
            #{endTime},
            #{discount},
            #{remark}
        ); 
    </insert>

    <!-- 根据ComDiscount插入多条数据方法 -->
    <insert id="inserts" parameterType="List" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        insert into com_discount (id,commodity,start_time,end_time,discount,remark) values 
        <foreach collection="comdiscounts" item="item" separator=",">
            (
                #{item.id},
                #{item.commodity},
                #{item.startTime},
                #{item.endTime},
                #{item.discount},
                #{item.remark}
            ) 
        </foreach>
    </insert>

    <!-- 根据ComDiscount条件修改单条数据方法,从传入对象获取主键id -->
    <update id="updateById" parameterType="ComDiscount">
        update com_discount 
        <set>
            <if test="commodity != null">commodity = #{commodity},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="discount != null">discount = #{discount},</if>
            <if test="remark != null">remark = #{remark},</if>
        </set>
        where id = #{id}
    </update>

    <!-- 根据商品id查询商品折扣信息 -->
    <select id="queryDiscount" resultMap="ComDiscountMap">
        select id, commodity, start_time, end_time, discount, remark from com_discount
        where commodity=#{id} and (NOW() between start_time and end_time) order by id desc limit 1;
    </select>

</mapper>